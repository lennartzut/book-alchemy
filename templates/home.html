<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Library</title>
    <link rel="stylesheet" href="static/styles.css">
</head>
<body>
    <div class="container">
        <h1 class="library-title">My Cozy Library</h1>

        <div class="nav-buttons">
            <a href="{{ url_for('add_author') }}" class="nav-button">Add Author</a>
            <a href="{{ url_for('add_book') }}" class="nav-button">Add Book</a>
        </div>

        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div class="flash-messages">
                {% for message in messages %}
                  <p class="success-message">{{ message }}</p>
                {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <form action="/" method="get" class="search-form">
            <label for="search_query">Search:</label>
            <input type="text" id="search_query" name="search_query" placeholder="Search by title or author" value="{{ search_query }}">

            <label for="sort_by">Sort by:</label>
            <select name="sort_by" id="sort_by" onchange="this.form.submit()">
                <option value="title" {% if sort_by == 'title' %}selected{% endif %}>Title</option>
                <option value="author" {% if sort_by == 'author' %}selected{% endif %}>Author</option>
            </select>

            <button type="submit" class="search-button">Search</button>
        </form>

        <div class="book-list">
            {% if books %}
                {% for book in books %}
                    <div class="book-item">
                        <img src="{{ book.cover_image_url }}" alt="Book cover" class="book-cover">

                        <div class="book-info">
                            <div class="book-title-section">
                                <h3 class="book-title">{{ book.title }}</h3>
                                <form action="{{ url_for('delete_book', book_id=book.id) }}" method="POST" class="delete-book-form">
                                    <button type="submit" class="delete-button">Delete Book</button>
                                </form>
                            </div>
                            <div class="book-author-section">
                                <p class="book-author">by {{ book.author.name }}</p>
                                <form action="{{ url_for('delete_author', author_id=book.author.id) }}" method="POST" class="delete-author-form">
                                    <button type="submit" class="delete-author-button">Delete Author</button>
                                </form>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            {% else %}
                <p class="no-books-message">No books found matching your search criteria.</p>
            {% endif %}
        </div>
    </div>
</body>
</html>